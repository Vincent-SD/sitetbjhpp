{% extends 'base.html.twig' %}
{% block title %}Marchés{% endblock %}

{% block body %}
    <style>
        body {
            color:black;
            background-color:white;
            background-image:url({{ asset(marche.image) }});
            background-attachment:fixed;
            background-size: cover;
            background-repeat: no-repeat;
        }
    </style>

    <div id="nomMarche">
        <h1>{{ marche.name }}</h1>
        <h3 class="blockquote">{{ marche.description }}</h3>

    </div>
    {% if is_granted('ROLE_ADMIN') %}
        <div class="text-center mt-2">
            <a style="font-size: 25px; background-color: forestgreen; border-color: forestgreen" class="btn btn-primary btn-lg active"
               href="{{ path('marche_edit', {'id': marche.id }) }}"
               role="button" aria-pressed="true">Modifier ce marché
            </a>
        </div>
    {% endif %}

    <ul class="produitsDuMarche">
        {% for produit in produits %}
            <div class="card le-produit mb-4" >
                <div class="mt-1 tamere">
                    <div class="my-5 ml-3">{{ produit }}</div>
                    <img src="{{ asset(produit.getImage()) }}" class="image my-5">
                    <div class="my-5 mx-3">{{ produit.type }}</div>

                </div>

                <div class="text-center offset-4"> <p class="text-center prix-produit col-6">{{ produit.prix }} couronnes</p></div>
                {% if app.user %}
                <div class="text-center">
                    <a href="{{ path('marche_show', {'id': marche.id} )  }}"
                       role="button" class="btn btn-primary" data-toggle="modal" data-target="#confirmModal{{ produit.id }}"
                       style="background-color: #1e7e34; border-color: #1e7e34; border-width: 2px">
                        Acheter
                    </a>

                        <div class="modal hide fade text-center" id="confirmModal{{ produit.id }}"
                             style="background-color: rgba(45,148,40,0.8); border-color: #1e7e34A0; border-width: 2px; width: 13em; height: 13em; margin-top: 3em">
                            <div class="modal-header">
                                <h3 class="col-12 text-center">Confirmation de l'achat</h3>
                            </div>
                            <div class="modal-body">
                                <p>Etes-vous sûr de vouloir acheter ce produit ?</p>
                            </div>
                            <div class="text-center">
                                <a href="{{ path('marche_show', {'id': marche.id} )}}"
                                   class="btn btn-primary" style="background-color: #5a6268; border-color: #5a6268">Non</a>

                                {% if app.user.couronnes < produit.prix  %}
                                    <a href="{{ path('produit_achat', {'id': produit.id,'marcheId': marche.id}) }}"
                                       class="btn btn-primary" id="confirmAchatProduit" style="background-color:red; border-color: red">Oui</a>
                                {% else %}
                                    <a href="{{ path('produit_achat', {'id': produit.id,'marcheId': marche.id}) }}"
                                       class="btn btn-primary" id="confirmAchatProduit">Oui</a>
                                {% endif %}

                            </div>
                        </div>


                    <!-- SI LE MEC EST ADMIN AFFICHER LE LIEN POUR MODIFIER LE PRODUIT -->
                    {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('produit_edit', {'id': produit.id} )  }}"
                           role="button" class="btn btn-primary" style="background-color: tomato; border-color: tomato; border-width: 2px">
                            Modifier le produit
                        </a>
                    {% endif %}
                </div>
                {% endif %}

            </div>
        {% endfor %}
    </ul>

    <script>
        $(document).ready(function () {
            var href;

            $(".confirmModalLink").click(function(e) {
                e.preventDefault();
                href = $(this).attr("href");
                $("#confirmModal").modal("show");
            });

            $("#confirmModalNo").click(function(e) {
                $("#confirmModal").modal("hide");
            });

            $("#confirmModalYes").click(function(e) {
                window.location.href = href;
            });

        });

    </script>


{% endblock %}